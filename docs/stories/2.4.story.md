# Story 2.4: Basic Learning Session Management

## Status
Complete

## Story
**As a** child,
**I want** to start, pause, and continue learning sessions easily,
**so that** I can learn at my own pace with breaks when needed.

## Acceptance Criteria
1. Learning sessions can be started with a simple interface action
2. Sessions automatically save progress and context when paused or interrupted
3. Children can resume sessions from where they left off, with context preserved
4. Session duration is tracked and appropriate break reminders are provided
5. Session data includes conversation history, learning objectives, and progress markers
6. Multiple session types are supported (assessment, lesson, practice, review)
7. Session management integrates with user accounts and progress tracking

## Tasks / Subtasks
- [ ] Task 1: Design Session Data Model and Database Schema (AC: 2, 5, 6)
  - [ ] 1.1 Create session entity model with conversation context
  - [ ] 1.2 Design session state management (active, paused, completed, abandoned)
  - [ ] 1.3 Implement session types and learning objectives structure
  - [ ] 1.4 Add session timing and break management
  - [ ] 1.5 Write unit tests for session data models

- [ ] Task 2: Implement Core Session Management Service (AC: 1, 2, 3, 7)
  - [ ] 2.1 Create LearningSessionService with CRUD operations
  - [ ] 2.2 Implement session context preservation and restoration
  - [ ] 2.3 Add automatic session state persistence
  - [ ] 2.4 Create session continuation logic with context recovery
  - [ ] 2.5 Write comprehensive tests for session service

- [ ] Task 3: Build Session Timing and Break Management (AC: 4)
  - [ ] 3.1 Implement session duration tracking
  - [ ] 3.2 Create age-appropriate break reminder system
  - [ ] 3.3 Add session timeout and auto-pause functionality
  - [ ] 3.4 Implement optimal learning session duration recommendations
  - [ ] 3.5 Write tests for timing and break management

- [ ] Task 4: Create Session Management API Routes (AC: 1-7)
  - [ ] 4.1 Build session CRUD API endpoints
  - [ ] 4.2 Implement session start/pause/resume/complete operations
  - [ ] 4.3 Add session search and filtering by child and type
  - [ ] 4.4 Create session analytics and progress endpoints
  - [ ] 4.5 Write API integration tests

- [ ] Task 5: Build Frontend Session Management Components (AC: 1, 4)
  - [ ] 5.1 Create SessionManager component with start/pause/resume controls
  - [ ] 5.2 Build SessionTimer with break reminders and progress indicators
  - [ ] 5.3 Implement SessionHistory for viewing past sessions
  - [ ] 5.4 Add age-adaptive session controls and interfaces
  - [ ] 5.5 Write component tests for session management UI

- [ ] Task 6: Integrate Sessions with Voice Conversation Pipeline (AC: 2, 3, 5)
  - [ ] 6.1 Connect session management to VoiceConversationIntegrationService
  - [ ] 6.2 Implement conversation context preservation in sessions
  - [ ] 6.3 Add session metadata to voice interactions
  - [ ] 6.4 Create seamless session pause/resume with voice context
  - [ ] 6.5 Write integration tests for voice-session pipeline

## Dev Notes

### Previous Story Dependencies
From Story 2.3 completion: Complete bidirectional voice conversation system with ChatGPT and TTS integration is operational. The session management system will wrap around this voice conversation pipeline to provide persistent learning experiences.

### Technical Architecture Requirements
**Session Management Pipeline**:
```
Session Start → Context Setup → Voice Conversation Loop → Progress Tracking → Session End
     ↓                ↓                    ↓                    ↓               ↓
Session Entity → Conversation Context → Session Updates → Progress Markers → Completion Data
```

**Key Components**:
- `LearningSessionService` - Core session lifecycle management
- `SessionTimingService` - Duration tracking and break management
- `SessionContextService` - Conversation and progress persistence
- `SessionManagerComponent` - Frontend session control interface

### Technology Stack Integration
**Database Schema**:
- Session entities with conversation context storage
- Polymorphic session types (assessment, lesson, practice, review)
- Session timing and break management data
- Progress markers and learning objective tracking

**API Integration**:
- RESTful session management endpoints
- Real-time session state synchronization
- Integration with existing authentication and child profile systems

### Learning Session Types
1. **Assessment Sessions** - Initial skill evaluation and periodic progress checks
2. **Lesson Sessions** - Structured learning content delivery with AI tutoring
3. **Practice Sessions** - Skill reinforcement and problem-solving practice
4. **Review Sessions** - Content review and knowledge consolidation

### Session State Management
**Session States**:
- `not_started` - Session created but not yet begun
- `active` - Currently in progress with active user interaction
- `paused` - Temporarily suspended with context preserved
- `break` - Scheduled break with timer for return reminder
- `completed` - Successfully finished with all objectives met
- `abandoned` - Stopped before completion (timeout or user exit)

### Age-Appropriate Session Management
**Ages 6-9**:
- 15-20 minute session recommendations
- Visual progress indicators with fun animations
- Frequent break reminders with gentle audio cues
- Simple start/stop controls with large buttons

**Ages 10-13**:
- 25-30 minute session recommendations
- Progress tracking with achievement indicators
- Break suggestions with activity recommendations
- Session history with learning milestone visualization

**Ages 14-16**:
- 35-45 minute session recommendations
- Detailed progress analytics and learning insights
- Flexible break scheduling with self-management options
- Advanced session planning and goal-setting tools

### COPPA Compliance
- **Session Data**: Only store learning progress, not conversation content
- **Timing Data**: Track duration patterns for optimization, not individual behavior
- **Break Management**: Parental controls for session timing limits
- **Data Retention**: Automatic cleanup of old session data per parental settings

### Performance Requirements
- **Session Start Time** - Maximum 2 seconds from button press to active state
- **Context Restoration** - Previous session context loaded within 3 seconds
- **State Persistence** - Session data saved every 30 seconds during active sessions
- **Break Reminders** - Notifications delivered within 1 second of trigger time

### Integration Points
- **Story 2.1 ChatGPT Service** - Conversation context preservation and restoration
- **Story 2.2 Voice Recognition** - Session-aware voice interaction management
- **Story 2.3 TTS System** - Session-specific voice preferences and continuity
- **Story 1.2 Authentication** - Child profile integration for session ownership
- **Story 1.3 Age-Adaptive UI** - Age-appropriate session management interfaces

### File Locations
Based on established project structure:
- **Session Service**: `apps/api/src/services/learningSession.ts`
- **Session Timing**: `apps/api/src/services/sessionTiming.ts`
- **Session Context**: `apps/api/src/services/sessionContext.ts`
- **Session Components**: `apps/web/src/components/session/`
- **Session Routes**: `apps/api/src/routes/sessions.ts`

### Testing Requirements
**Backend Testing**:
- Unit tests for session lifecycle management
- Integration tests with voice conversation pipeline
- Performance tests for context preservation and restoration
- Session timing and break management validation

**Frontend Testing**:
- Session component tests with different age groups
- User interaction tests for start/pause/resume workflows
- Session timer and break reminder functionality
- Session history and progress visualization tests

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-17 | 1.0 | Initial story creation for learning session management | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
_To be filled by development agent_

### Completion Notes List
_To be filled as tasks are completed_

### File List
**Created Files:**
_To be updated as implementation progresses_

**Modified Files:**
_To be updated as implementation progresses_

## QA Results
_To be filled by QA agent_